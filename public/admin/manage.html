<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Wallpapers - Walleyt Admin</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #0d1117;
        color: #c9d1d9;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        margin-bottom: 30px;
        background: linear-gradient(135deg, #6366f1, #a855f7);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .nav-links {
        margin-bottom: 20px;
        display: flex;
        gap: 15px;
      }

      .nav-links a {
        color: #58a6ff;
        text-decoration: none;
      }

      .wallpaper-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .wallpaper-item {
        background: #161b22;
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid #30363d;
        transition: transform 0.2s;
      }

      .wallpaper-item:hover {
        transform: translateY(-4px);
        border-color: #58a6ff;
      }

      .wallpaper-thumb {
        width: 100%;
        aspect-ratio: 3/4;
        object-fit: cover;
      }

      .wallpaper-info {
        padding: 12px;
      }

      .wallpaper-title {
        font-weight: 600;
        margin-bottom: 4px;
      }

      .wallpaper-category {
        font-size: 0.875rem;
        color: #8b949e;
        margin-bottom: 12px;
      }

      .wallpaper-actions {
        display: flex;
        gap: 8px;
      }

      .btn {
        flex: 1;
        padding: 8px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.875rem;
        transition: all 0.2s;
      }

      .btn-edit {
        background: #1f6feb;
        color: white;
      }

      .btn-edit:hover {
        background: #388bfd;
      }

      .btn-delete {
        background: #da3633;
        color: white;
      }

      .btn-delete:hover {
        background: #f85149;
      }

      .modal {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: #161b22;
        padding: 30px;
        border-radius: 12px;
        max-width: 500px;
        width: 90%;
        border: 1px solid #30363d;
      }

      .modal-title {
        font-size: 1.25rem;
        margin-bottom: 20px;
      }

      input,
      select {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        background: #0d1117;
        border: 1px solid #30363d;
        color: white;
        border-radius: 6px;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .loading {
        text-align: center;
        padding: 40px;
        color: #8b949e;
      }

      @keyframes slideIn {
        from {
          transform: translateX(400px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(400px);
          opacity: 0;
        }
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <div class="nav-links">
        <a href="/admin"><i class="fas fa-arrow-left"></i> Back to Uploader</a>
        <a href="/admin/analytics.html"
          ><i class="fas fa-chart-line"></i> Analytics</a
        >
      </div>

      <h1>üñºÔ∏è Manage Wallpapers</h1>

      <div id="wallpaper-grid" class="wallpaper-grid">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i> Loading...
        </div>
      </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <h3 class="modal-title">Edit Wallpaper</h3>
        <input type="text" id="edit-title" placeholder="Title" />
        <select id="edit-category"></select>
        <input
          type="text"
          id="edit-tags"
          placeholder="Tags (comma separated)"
        />
        <select id="edit-resolution">
          <option value="HD">HD</option>
          <option value="FHD">FHD (1080p)</option>
          <option value="2K">2K</option>
          <option value="4K">4K</option>
          <option value="8K">8K</option>
        </select>
        <div class="modal-actions">
          <button class="btn btn-edit" onclick="saveEdit()">Save</button>
          <button
            class="btn"
            style="background: #30363d"
            onclick="closeModal()"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Delete Modal -->
    <div id="deleteModal" class="modal">
      <div class="modal-content">
        <h3 class="modal-title">Delete Wallpaper?</h3>
        <p style="color: #8b949e; margin-bottom: 20px">
          This action cannot be undone.
        </p>
        <div class="modal-actions">
          <button class="btn btn-delete" onclick="confirmDelete()">
            Delete
          </button>
          <button
            class="btn"
            style="background: #30363d"
            onclick="closeModal()"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>

    <script>
      // Use current host for API URL (works for both localhost and production)
      const API_URL = window.location.origin + "/api";
      let wallpapers = [];
      let currentWallpaper = null;

      function showToast(message, type = "info") {
        const toast = document.createElement("div");
        toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                background: ${
                  type === "success"
                    ? "#238636"
                    : type === "error"
                    ? "#da3633"
                    : "#1f6feb"
                };
                color: white;
                font-weight: 600;
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => {
          toast.style.animation = "slideOut 0.3s ease";
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      async function loadWallpapers() {
        try {
          const response = await fetch(`${API_URL}/wallpapers`);
          wallpapers = await response.json();
          renderWallpapers();
        } catch (error) {
          console.error("Failed to load wallpapers:", error);
        }
      }

      async function loadCategories() {
        try {
          const response = await fetch(`${API_URL}/categories`);
          const categories = await response.json();

          const select = document.getElementById("edit-category");
          select.innerHTML = '<option value="">Select category</option>';
          categories.forEach((cat) => {
            const option = document.createElement("option");
            option.value = cat;
            option.textContent = cat;
            select.appendChild(option);
          });
        } catch (error) {
          console.error("Failed to load categories:", error);
        }
      }

      function renderWallpapers() {
        const grid = document.getElementById("wallpaper-grid");

        if (wallpapers.length === 0) {
          grid.innerHTML = '<div class="loading">No wallpapers yet</div>';
          return;
        }

        grid.innerHTML = wallpapers
          .map(
            (w) => `
                <div class="wallpaper-item">
                    <img src="${w.filename}" class="wallpaper-thumb" alt="${
              w.title
            }">
                    <div class="wallpaper-info">
                        <div class="wallpaper-title">${w.title}</div>
                        <div class="wallpaper-category">${w.category} ‚Ä¢ ${
              w.resolution || "HD"
            }</div>
                        <div class="wallpaper-actions">
                            <button class="btn btn-edit" onclick="openEdit('${
                              w.id
                            }')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-delete" onclick="openDelete('${
                              w.id
                            }')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `
          )
          .join("");
      }

      function openEdit(id) {
        currentWallpaper = wallpapers.find((w) => w.id === id);

        document.getElementById("edit-title").value = currentWallpaper.title;
        document.getElementById("edit-category").value =
          currentWallpaper.category;
        document.getElementById("edit-tags").value = currentWallpaper.tags
          ? currentWallpaper.tags.join(", ")
          : "";
        document.getElementById("edit-resolution").value =
          currentWallpaper.resolution || "HD";

        document.getElementById("editModal").classList.add("active");
      }

      function openDelete(id) {
        currentWallpaper = wallpapers.find((w) => w.id === id);
        document.getElementById("deleteModal").classList.add("active");
      }

      function closeModal() {
        document.getElementById("editModal").classList.remove("active");
        document.getElementById("deleteModal").classList.remove("active");
        currentWallpaper = null;
      }

      async function saveEdit() {
        const title = document.getElementById("edit-title").value;
        const category = document.getElementById("edit-category").value;
        const tags = document
          .getElementById("edit-tags")
          .value.split(",")
          .map((t) => t.trim())
          .filter((t) => t);
        const resolution = document.getElementById("edit-resolution").value;

        if (!title || !category) {
          showToast("Title and category are required", "error");
          return;
        }

        try {
          const response = await fetch(
            `${API_URL}/wallpapers/${currentWallpaper.id}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                title,
                category,
                tags,
                resolution,
              }),
            }
          );

          if (response.ok) {
            closeModal();
            loadWallpapers();
            showToast("‚úÖ Wallpaper updated!", "success");
          } else {
            showToast("‚ùå Failed to update wallpaper", "error");
          }
        } catch (error) {
          console.error("Error:", error);
          showToast("‚ùå Failed to update wallpaper", "error");
        }
      }

      async function confirmDelete() {
        try {
          const response = await fetch(
            `${API_URL}/wallpapers/${currentWallpaper.id}`,
            {
              method: "DELETE",
            }
          );

          if (response.ok) {
            closeModal();
            loadWallpapers();
            showToast("‚úÖ Wallpaper deleted!", "success");
          } else {
            showToast("‚ùå Failed to delete wallpaper", "error");
          }
        } catch (error) {
          console.error("Error:", error);
          showToast("‚ùå Failed to delete wallpaper", "error");
        }
      }

      // Initialize
      loadWallpapers();
      loadCategories();
    </script>
  </body>
</html>
